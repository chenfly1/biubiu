{% extends "base.html" %}
{% block label %}
    <h1 class="page-header">资产列表</h1>
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-lg-2">
                            <h5>设备列表</h5>
                        </div>
                        <div class="col-lg-10">


                            <button  class=" btn btn-success btn-sm" style="float:right;" data-toggle="modal" data-target="#up_down">
                                导入导出数据
                            </button>
                            <button  class=" btn btn-success btn-sm" style="float:right;" data-toggle="modal" data-target="#addhosts">
                                添加设备
                            </button>
                        </div>
                    </div>
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                            <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example">
                                <thead>
                                    <tr >
                                        <th class="text-center" >设备编码</th>
                                        <th class="text-center">设备名称</th>
                                        <th class="text-center">品牌</th>
                                        <th class="text-center">部门</th>
                                        <th class="text-center">使用人</th>
                                        <th class="text-center">当前状态</th>
                                        <th class="text-center">操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                {% for list in listdata %}
                                    <tr class="text-center">

                                        <td >{{ list.sn }}</td>
                                        <td>{{ list.name }}</td>
                                        <td>{{ list.brand }}</td>
                                        <td>{{ list.department }}</td>
                                        <td>{{ list.user }}</td>
                                        <td>{{ list.statue }}</td>
                                        <td>
                                            <button class="btn btn-success">
                                                <a href="/asset/desktop_info/{{ list.id }}">查看</a>
                                            </button>
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>
        <!-- /.col-lg-12 -->
    </div>

    <!--添加设备信息模态框 -->
    <div class="modal fade" id="addhosts" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">添加设备</h4>
          </div>
          <div class="modal-body">
              <div class="row">
                    <div class="col-lg-6">
                        <form role="form">
                            <div class="form-group input-group">

                                <span class="btn-success input-group-addon ">设备编码</span>
                                <input class="form-control" placeholder="例如：笔记本“PF0603HR”" id="sn" name="sn">
                                <div id = "sn_error" style = "color: red"></div>
                            </div>
                            <div class="form-group input-group">

                                <span class="btn-success input-group-addon ">设备名称</span>
                                <input class="form-control" placeholder="笔记本" id="name" name="name">
                                <div id = "name_error" style = "color: red"></div>
                            </div>
                            <div class="form-group input-group">
                                <span class="btn-success input-group-addon ">品	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;牌</span>
                                <input class="form-control"  placeholder="联想" id="brand" name="brand">
                                <div id = "brand_error" style = "color: red"></div>
                            </div>
                            <div class="form-group input-group">
                                <span class="btn-success input-group-addon ">数	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;量</span>
                                <input class="form-control"  placeholder="1" id="number" name="number">
                                <div id = "number_error" style = "color: red"></div>
                            </div>
                            <div class="form-group input-group">
                                <span class="btn-success input-group-addon ">型	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;号</span>
                                <input class="form-control"  placeholder="E470" id="type" name="type">
                                <div id = "type_error" style = "color: red"></div>
                            </div>
                            <div class="form-group input-group">
                                <span class="btn-success input-group-addon ">部	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;门</span>
                                <input class="form-control"  placeholder="系统运维部" id="department" name="department">
                                <div id = "department_error" style = "color: red"></div>
                            </div>
                            <div class="form-group input-group">
                                <span class="btn-success input-group-addon ">使&nbsp;&nbsp;用&nbsp;人</span>
                                <input class="form-control"  placeholder="张三/李四" id="user" name="user">
                                <div id = "user_error" style = "color: red"></div>
                            </div>
                            <div class="form-group input-group">
                                <span class="btn-success input-group-addon ">状	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;态</span>
                                <input class="form-control"  placeholder="在用/闲置" id="statue" name="statue">
                                <div id = "statue_error" style = "color: red"></div>
                            </div>
                            <div class="form-group input-group">
                                <span class="btn-success input-group-addon ">所在位置</span>
                                <input class="form-control"  placeholder="3A区/库房" id="location" name="location">
                                <div id = "location_error" style = "color: red"></div>
                            </div>
                            <div class="form-group input-group">
                                <span class="btn-success input-group-addon ">出厂时间</span>
                                <input class="form-control"  type="date" id="delivery_time" name="delivery_time">
                                <div id = "delivery_time_error" style = "color: red"></div>
                            </div>
                            <div class="form-group input-group">
                                <span class="btn-success input-group-addon ">备&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注</span>
                                <input class="form-control"  placeholder="备注" id="remark" name="remark">
                            </div>
                        </form>
                    </div>
              </div>

          </div>
          <div class="modal-footer">
              <div id = "sub_error" style = "color: red"></div>
              <button type="button" class="btn btn-default btn-sm" data-dismiss="modal">关闭</button>
              <button type="button" class="btn btn-primary btn-sm" id="sub_addhosts">添加</button>
          </div>
        </div>
      </div>
    </div>
    <!--/添加设备信息模态框 -->

    <!--导入导出数据模态框 -->
    <div class="modal fade" id="up_down" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">导入导出数据</h4>
          </div>
          <div class="modal-body">
              <div class="row">
                    <div class="col-lg-6">
                        <form role="form">
                            <div class="form-group ">
                                <button type="submit" class="btn btn-greensea">
                                        <a href="/asset/desktops_downlload_excelmodels">模板</a>
                                    </button>
                            </div>
                            <div class="form-group input-group">
                                 <span class="input-group-addon btn-success" id = "desktops_upload_button">导入</span><input  type="file" id="upload_file" class="form-control" >
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-greensea">
                                        <a href="/asset/desktops_download_alldata">导出</a>
                                </button>
                            </div>

                        </form>
                    </div>
              </div>
          </div>
        </div>
      </div>
    </div>
    <!--/导入导出数据模态框 -->

{% endblock %}
{% block script %}
    <script type="text/javascript">
        var idname = document.getElementById('list_id').innerHTML;
        $(document).ready(function(){
          $("#subinfo").click(function(){
             alert(idname);
          });
        });
    </script>
    <!-- tables表-->
    <script>
        $(document).ready(function() {
            $('#dataTables-example').DataTable({
                //允许重新初始化
                responsive: true,
                language:{
                    "decimal":        "",
                    "emptyTable":     "没有匹配到有效数据",
                    "info":           "显示 _START_ - _END_ 条，  共 _TOTAL_ 条记录 (共_PAGES_页）",
                    "infoEmpty":      "显示 0 to 0 of 0 条记录",
                    "infoFiltered":   "( 从 _MAX_ 记录中过滤)",
                    "infoPostFix":    "",
                    "thousands":      ",",
                    "lengthMenu":     "显示 _MENU_ 条记录",
                    "loadingRecords": "加载中...",
                    "processing":     "加载中...",
                    "search":         "搜索:",
                    "zeroRecords":    "没有找到匹配记录",
                    "paginate": {
                        "first":      "首页",
                        "last":       "尾页",
                        "next":       "下一页",
                        "previous":   "上一页"
                    },
                    "aria": {
                        "sortAscending":  ": activate to sort column ascending",
                        "sortDescending": ": activate to sort column descending"
                    },

                }


            });
        });
    </script>
    <!-- /tables表-->

    <!-- excel数据导入-->
    <script type="text/javascript">

        $(function(){

            $('#desktops_upload_button').click(function () {
{#                        定义一个数组准备接收数据#}
                    var filedata = new FormData();
{#                        获取用户选择的文件保存到一个变量中#}
                    var fileinfo = $('#upload_file')[0].files[0];
                    filedata.append("file",fileinfo)
                    $.ajax({
                            type: "POST",
                            url: "/asset/desktops_upload_file/",
                            data:filedata,
                            contentType:false,
                            processData:false,
                            success: function (data) {
                                var statue = data['statue'];
                                var info = data["data"];
                                if(statue == "success"){
                                    alert(info);

                                    if(statue == "error") {
                                        alert(info);

                                    }
                                }else if(statue == "error") {
                                    alert(info);



                                    }
                            },

                            error:function (error) {
                                console.log(error);

                            }

                        });
                });

        });

    </script>
     <!-- /excel数据导入-->

    <!-- 添加设备-->
    <script>
        $(function(){
                var register_valid = [];
                $("#sn").blur(
                    function () {
                        var sn = $("#sn").val();
                        if (sn){
                            $.ajax({
                                url:"/asset/sn_valid/?sn="+sn,
                                type:"get",
                                data:"",
                                success:function (data) {
                                    data_type = data["type"];
                                    if (data_type !== "success"){
                                        $("#sn_error").text(data["data"]);
{#                                        alert(data["data"])#}
                                    }else{
                                        if(register_valid.indexOf("sn") == -1){
                                            register_valid.push("sn");
                                        }
                                        $("#sn_error").text(" ");
                                    }
                                    console.log(data)
                                },
                                error:function (error) {
                                    console.log(error)
                                }
                            })

                        }else {
                            $("#sn_error").text("不能为空");
                        }

                    }
                );
                $("#name").blur(
                    function () {
                        var name = $("#name").val();
                        if(name){
                            if(register_valid.indexOf("name") == -1){
                                register_valid.push("name");
                            }
                            $("#name_error").text("");
                        }else {
                            $("#name_error").text("不能为空");
                        }

                    }
                );
                $("#brand").blur(
                    function () {
                        var brand = $("#brand").val();
                        if(brand){
                            if(register_valid.indexOf("brand") == -1){
                                register_valid.push("brand");
                            }
                            $("#brand_error").text("");
                        }else {
                            $("#brand_error").text("不能为空");
                        }

                    }
                );
                $("#number").blur(
                    function () {
                        var number = $("#number").val();
                        if(number){
                            if(register_valid.indexOf("number") == -1){
                                register_valid.push("number");
                            }
                            $("#number_error").text("");
                        }else {
                            $("#number_error").text("不能为空");
                        }

                    }
                );
                $("#type").blur(
                    function () {
                        var type = $("#type").val();
                        if(type){
                            if(register_valid.indexOf("type") == -1){
                                register_valid.push("type");
                            }
                            $("#type_error").text("");
                        }else {
                            $("#type_error").text("不能为空");
                        }

                    }
                );
                $("#department").blur(
                    function () {
                        var department = $("#department").val();
                        if(department){
                            if(register_valid.indexOf("department") == -1){
                                register_valid.push("department");
                            }
                            $("#department_error").text("");
                        }else {
                            $("#department_error").text("不能为空");
                        }

                    }
                );
                $("#user").blur(
                    function () {
                        var user = $("#user").val();
                        if(user){
                            if(register_valid.indexOf("user") == -1){
                                register_valid.push("user");
                            }
                            $("#user_error").text("");
                        }else {
                            $("#user_error").text("不能为空");
                        }

                    }
                );
                $("#statue").blur(
                    function () {
                        var statue = $("#statue").val();
                        if(statue){
                            if(register_valid.indexOf("statue") == -1){
                                register_valid.push("statue");
                            }
                            $("#statue_error").text("");
                        }else {
                            $("#statue_error").text("不能为空");
                        }

                    }
                );
                $("#location").blur(
                    function () {
                        var location = $("#location").val();
                        if(location){
                            if(register_valid.indexOf("location") == -1){
                                register_valid.push("location");
                            }
                            $("#location_error").text("");
                        }else {
                            $("#location_error").text("不能为空");
                        }

                    }
                );
                $("#delivery_time").blur(
                    function () {
                        var delivery_time = $("#delivery_time").val();
                        if(delivery_time){
                            if(register_valid.indexOf("delivery_time") == -1){
                                register_valid.push("delivery_time");
                            }
                            $("#delivery_time_error").text("");
                        }else {
                            $("#delivery_time_error").text("不能为空");
                        }

                    }
                );


                $("#sub_addhosts").click(
                    function () {
                        if (register_valid.length < 10){
                            console.log(register_valid,register_valid.length)
                            $("#sub_error").text("信息没有填写完整，请重新输入");
                        }else {
                            var sn = $("#sn").val();
                            var name = $("#name").val();
                            var brand = $("#brand").val();
                            var number = $("#number").val();
                            var type = $("#type").val();
                            var department = $("#department").val();
                            var user = $("#user").val();
                            var statue = $("#statue").val();
                            var location = $("#location").val();
                            var delivery_time = $("#delivery_time").val();
                            var remark = $("#remark").val();

                            var formdata = new FormData(); //new一个form类来作为容器
                            formdata.append("sn",sn);
                            formdata.append("name",name);
                            formdata.append("brand",brand);
                            formdata.append("number",number);
                            formdata.append("type",type);
                            formdata.append("department",department);
                            formdata.append("user",user);
                            formdata.append("statue",statue);
                            formdata.append("location",location);
                            formdata.append("delivery_time",delivery_time);
                            formdata.append("remark",remark);
                            formdata.append("csrfmiddlewaretoken","{{ csrf_token }}");
                            $.ajax({
                                url:"/asset/desktop_register/",
                                type:"post",
                                data:formdata,
                                processData:false, //不进行序列化
                                contentType:false, //不进行类型检测
                                success:function (data) {
                                    type = data["type"]
                                    if ( type == "success"){
                                        $("#sn").val("");
                                        $("#name").val("");
                                        $("#brand").val("");
                                        $("#number").val("");
                                        $("#type").val("");
                                        $("#department").val("");
                                        $("#user").val("");
                                        $("#statue").val("");
                                        $("#location").val("");
                                        $("#delivery_time").val("");
                                        $("#remark").val("");
                                        $("#addhosts").modal("hide")
                                        console.log(data)
                                    }else {
                                        Data = data["data"];
                                       console.log(Data)

                                    }

                                },
                                error:function(error){
                                    console.log(error)
                                }
                            })
                        }
                    }
                );

            })
    </script>
    <!-- /添加设备-->
{% endblock %}
